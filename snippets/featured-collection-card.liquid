{% comment %}
  Product Card for Featured Collection

  Accepts:
  - product: {Object} Product object
  - section: {Object} Section settings
  - product_index: {Number} Index of product (0-based)
{% endcomment %}

<div class="fc-product-card{% if section.settings.overlay_info_on_image_mobile %} fc-product-card--overlay-mobile{% endif %}" data-section-id="{{ section.id }}" data-product-id="{{ product.id }}">
  <a href="{{ product.url }}" class="fc-product-link">

    {% comment %} Product Image {% endcomment %}
    <div class="fc-product-image-wrapper">
      {% if product.featured_image %}
        {% comment %} All images lazy load for better performance {% endcomment %}
        <img
          srcset="{{ product.featured_image | image_url: width: 200 }} 200w,
                  {{ product.featured_image | image_url: width: 400 }} 400w,
                  {{ product.featured_image | image_url: width: 600 }} 600w,
                  {{ product.featured_image | image_url: width: 800 }} 800w"
          sizes="(max-width: 640px) 50vw, (max-width: 1024px) 33vw, 25vw"
          src="{{ product.featured_image | image_url: width: 600 }}"
          alt="{{ product.featured_image.alt | escape }}"
          loading="lazy"
          width="{{ product.featured_image.width }}"
          height="{{ product.featured_image.height }}"
          class="fc-product-image"
        >
      {% else %}
        {{ 'product-1' | placeholder_svg_tag: 'fc-product-image' }}
      {% endif %}

      {% comment %} Sale Badge with Savings {% endcomment %}
      {% if section.settings.show_sale_badge and product.compare_at_price > product.price %}
        {% liquid
          assign savings = product.compare_at_price | minus: product.price
          assign savings_percent = savings | times: 100.0 | divided_by: product.compare_at_price | round
          assign savings_money = savings | money
          assign badge_text = settings.badge_text | default: 'Save [percentage]%'
          assign badge_text = badge_text | replace: '[price]', savings_money
          assign badge_text = badge_text | replace: '[percentage]', savings_percent
        %}
        <div class="fc-sale-badge">
          {{ badge_text }}
        </div>
      {% endif %}

      {% comment %} Custom Badges {% endcomment %}
      {% if section.settings.show_custom_badges and section.settings.badge_assignments != blank %}
        {% liquid
          assign badge_assignments_string = section.settings.badge_assignments | strip
          assign badge_assignments_array = badge_assignments_string | split: ','
          assign current_badge = badge_assignments_array[product_index] | strip
        %}

        {% if current_badge != 'blank' and current_badge != '' %}
          {% case current_badge %}
            {% when '1' %}
              {% if section.settings.badge_1_text != blank %}
                <div class="fc-custom-badge fc-custom-badge-1">
                  {% if section.settings.badge_1_custom_icon != blank %}
                    <span class="fc-badge-icon fc-badge-icon-svg">
                      {{ section.settings.badge_1_custom_icon }}
                    </span>
                  {% elsif section.settings.badge_1_icon != blank %}
                    <span class="fc-badge-icon">
                      {% render 'material-icon', icon: section.settings.badge_1_icon, filled: section.settings.badge_1_icon_filled %}
                    </span>
                  {% endif %}
                  <span class="fc-badge-text">{{ section.settings.badge_1_text }}</span>
                </div>
              {% endif %}
            {% when '2' %}
              {% if section.settings.badge_2_text != blank %}
                <div class="fc-custom-badge fc-custom-badge-2">
                  {% if section.settings.badge_2_custom_icon != blank %}
                    <span class="fc-badge-icon fc-badge-icon-svg">
                      {{ section.settings.badge_2_custom_icon }}
                    </span>
                  {% elsif section.settings.badge_2_icon != blank %}
                    <span class="fc-badge-icon">
                      {% render 'material-icon', icon: section.settings.badge_2_icon, filled: section.settings.badge_2_icon_filled %}
                    </span>
                  {% endif %}
                  <span class="fc-badge-text">{{ section.settings.badge_2_text }}</span>
                </div>
              {% endif %}
            {% when '3' %}
              {% if section.settings.badge_3_text != blank %}
                <div class="fc-custom-badge fc-custom-badge-3">
                  {% if section.settings.badge_3_custom_icon != blank %}
                    <span class="fc-badge-icon fc-badge-icon-svg">
                      {{ section.settings.badge_3_custom_icon }}
                    </span>
                  {% elsif section.settings.badge_3_icon != blank %}
                    <span class="fc-badge-icon">
                      {% render 'material-icon', icon: section.settings.badge_3_icon, filled: section.settings.badge_3_icon_filled %}
                    </span>
                  {% endif %}
                  <span class="fc-badge-text">{{ section.settings.badge_3_text }}</span>
                </div>
              {% endif %}
          {% endcase %}
        {% endif %}
      {% endif %}
    </div>

    {% comment %} Product Info {% endcomment %}
    <div class="fc-product-info">
      {% comment %} Rating Stars {% endcomment %}
      {% if section.settings.show_rating_stars and section.settings.product_ratings != blank %}
        {% liquid
          assign ratings_string = section.settings.product_ratings | strip
          assign ratings_array = ratings_string | split: ','
          assign current_rating = ratings_array[product_index] | times: 1.0
          assign rating_percent = current_rating | times: 20.0
        %}

        <div class="fc-rating-stars">
          <div class="fc-rating-stars__container">
            <div class="fc-rating-stars__container--underlay">
              {% if section.settings.rating_bg_stars_style == 'outlined' %}
                {% for i in (1..5) %}
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                    <path d="M287.9 0c9.2 0 17.6 5.2 21.6 13.5l68.6 141.3 153.2 22.6c9 1.3 16.5 7.6 19.3 16.3s.5 18.1-5.9 24.5L433.6 328.4l26.2 155.6c1.5 9-2.2 18.1-9.6 23.5s-17.3 6-25.3 1.7l-137-73.2L151 509.1c-8.1 4.3-17.9 3.7-25.3-1.7s-11.2-14.5-9.7-23.5l26.2-155.6L31.1 218.2c-6.5-6.4-8.7-15.9-5.9-24.5s10.3-14.9 19.3-16.3l153.2-22.6L266.3 13.5C270.4 5.2 278.7 0 287.9 0zm0 79L235.4 187.2c-3.5 7.1-10.2 12.1-18.1 13.3L99 217.9 184.9 303c5.5 5.5 8.1 13.3 6.8 21L171.4 443.7l105.2-56.2c7.1-3.8 15.6-3.8 22.6 0l105.2 56.2L384.2 324.1c-1.3-7.7 1.2-15.5 6.8-21l85.9-85.1L358.6 200.5c-7.8-1.2-14.6-6.1-18.1-13.3L287.9 79z"/>
                  </svg>
                {% endfor %}
              {% else %}
                {% for i in (1..5) %}
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                    <path d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"/>
                  </svg>
                {% endfor %}
              {% endif %}
            </div>
            <div class="fc-rating-stars__container--overlay" style="width: {{ rating_percent }}%;">
              {% for i in (1..5) %}
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                  <path d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"/>
                </svg>
              {% endfor %}
            </div>
          </div>
        </div>
      {% endif %}

      {% if section.settings.show_title %}
        <h3 class="fc-product-title">{{ product.title }}</h3>
      {% endif %}

      {% if section.settings.show_price %}
        <div class="fc-product-price">
          {{ product.price | money }}
          {% if product.compare_at_price > product.price %}
            <span class="fc-compare-price">{{ product.compare_at_price | money }}</span>
          {% endif %}
        </div>
      {% endif %}
    </div>

  </a>

  {% comment %} View Product Button {% endcomment %}
  {% if section.settings.show_view_button %}
    <div class="fc-button-wrapper">
      <a
        href="{{ product.url }}"
        class="fc-view-product-btn"
        data-product-id="{{ product.id }}"
        data-product-handle="{{ product.handle }}"
      >
        {% if section.settings.button_icon_position == 'before' %}
          {% if section.settings.button_custom_icon != blank %}
            <span class="fc-button__icon-svg">
              {{ section.settings.button_custom_icon }}
            </span>
          {% elsif section.settings.button_icon != blank %}
            {% render 'material-icon', icon: section.settings.button_icon, filled: section.settings.button_icon_filled %}
          {% endif %}
        {% endif %}

        <span class="fc-button__label">{{ section.settings.button_text }}</span>

        {% if section.settings.button_icon_position == 'after' %}
          {% if section.settings.button_custom_icon != blank %}
            <span class="fc-button__icon-svg">
              {{ section.settings.button_custom_icon }}
            </span>
          {% elsif section.settings.button_icon != blank %}
            {% render 'material-icon', icon: section.settings.button_icon, filled: section.settings.button_icon_filled %}
          {% endif %}
        {% endif %}
      </a>
    </div>
  {% endif %}
</div>
